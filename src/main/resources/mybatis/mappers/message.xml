<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="message">
	<insert id="sendMessage" parameterType="messagevo">
			INSERT INTO MESSAGE(
					RECEIVER_EMPLOYEE_NO,
					SENDER_EMPLOYEE_NO,
					MESSAGE_CONTENT,
					WRITE_DATE
			) VALUES(
					(SELECT EMPLOYEE_NO FROM EMPLOYEE WHERE EMAIL=#{receiverEmail}),
					#{senderemployeeNo},
					#{message},
					SYSDATE
					)
	</insert>
	
	
		<select id="getMessage" resultType="messagevo">
		SELECT RECEIVER_EMPLOYEE_NO receiverEmployeeNo,
			  		 SENDER_EMPLOYEE_NO senderEmployeeNo,
				   (
				   SELECT	'[' ||	(SELECT TEAM_NAME FROM TEAM WHERE TEAM_ID = EMPLOYEE.TEAM_ID) || '] ' ||	 EMPLOYEE_NAME 				    
				    FROM EMPLOYEE 
				    WHERE EMPLOYEE_NO = MESSAGE.SENDER_EMPLOYEE_NO) SENDER,
			   		MESSAGE_CONTENT message,
			   		WRITE_DATE WRITEDATE
		FROM MESSAGE
		WHERE RECEIVER_EMPLOYEE_NO = #{employeeNo}
		
	</select>
</mapper>
